(this.webpackJsonpproject=this.webpackJsonpproject||[]).push([[0],{35:function(e,r,t){e.exports=t(51)},40:function(e,r,t){},41:function(e,r,t){},51:function(e,r,t){"use strict";t.r(r);var a=t(0),n=t.n(a),i=t(17),l=t.n(i),c=(t(40),t(41),t(4)),u=t.n(c),o=t(5),s=t(8),d=t(3),p=t(30),m=t(13),y=t(19),f=t(20),k=t.n(f)()(),g={},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,r=arguments.length>1?arguments[1]:void 0;return"LOGIN"===r.type?(localStorage.authToken=r.token,{data:"null"!=r.token?Object(y.a)(r.token):"",token:r.token}):"LOGOUT"===r.type?(localStorage.removeItem("authToken"),k.push("/registration"),{}):e},h={},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,r=arguments.length>1?arguments[1]:void 0;return"ADD_TRACK"===r.type?{originalFileName:"",artist:"",genre:"",year:""}:"ALL_TRACKS"===r.type?r.arrayAllSongs:e},v={},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,r=arguments.length>1?arguments[1]:void 0;return"CURRENT_TRACK"===r.type?{index:r.index}:e},b={},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,r=arguments.length>1?arguments[1]:void 0;return"ALL_PLAYLISTS"===r.type?{data:r}:e},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0;return"PLAYLIST_FIND"===r.type?r.text:e},L=t(11),_=t(15),j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,t=r.type,a=r.name,n=r.status,i=r.payload,l=r.error;return"PROMISE"===t?Object(_.a)(Object(_.a)({},e),{},Object(L.a)({},a,{status:n,payload:i,error:l})):e},w=Object(m.c)({authReducer:R,currentSongReducer:O,allTracksReducer:P,AllPlaylists:E,tracklistFindReducer:T,promiseReducer:j}),F=function(e){return{type:"LOGIN",token:e}},x=Object(m.d)(w,Object(m.a)(p.a));x.subscribe((function(){return console.log(" subscribe  ",x.getState())})),localStorage.authToken&&x.dispatch(F(localStorage.authToken));var N=x,S=function(){return{type:"LOGOUT"}},I=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{method:"POST",headers:Object(_.a)({Accept:"application/json","Content-Type":"application/json"},r),body:JSON.stringify({query:t,variables:a})}).then((function(e){return e.json()}))}},A=function(e){return{type:"PROMISE",status:"PENDING",payload:null,error:null,name:e}},C=function(e,r){return{type:"PROMISE",status:"RESOLVED",payload:r,error:null,name:e}},U=function(e,r){return{type:"PROMISE",status:"REJECTED",payload:null,error:r,name:e}};var D=function(e,r){return function(){var t=Object(o.a)(u.a.mark((function t(a){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(A(e)),t.prev=1,t.next=4,r;case 4:return n=t.sent,a(C(e,n)),t.abrupt("return",n);case 9:t.prev=9,t.t0=t.catch(1),a(U(e,t.t0));case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}()},q=I("/graphql");var G=function(e,r){return function(){var t=Object(o.a)(u.a.mark((function t(a){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(D("login",q('query log{\n          login(login:"'.concat(e,'", password:"').concat(r,'")\n          }'))));case 2:(n=t.sent)&&null!=n.data.login&&a(F(n.data.login))&&k.push("/");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$=I("/graphql");var H=function(e,r){return function(){var t=Object(o.a)(u.a.mark((function t(a){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(D("registration",$('mutation newUser{\n            createUser(login:"'.concat(e,'", password:"').concat(r,'"){\n             _id login\n           }\n        }\n         '))));case 2:if(null==t.sent.data.createUser){t.next=6;break}return t.next=6,a(G(e,r));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},M=Object(d.b)((function(e){return{loggedOrNotDescription:e.promiseReducer.login&&e.promiseReducer.login.payload&&null==e.promiseReducer.login.payload.data.login?"Wrong login or password":"Please log in",nameHasAlreadyTaken:e.promiseReducer.registration&&e.promiseReducer.registration.payload&&null==e.promiseReducer.registration.payload.data.createUser?"This name has already taken":"Please create your login and password"}}),null)((function(e){var r=Object(a.useState)(!0),t=Object(s.a)(r,2),i=t[0],l=t[1],c=Object(a.useState)("Windforce"),d=Object(s.a)(c,2),p=d[0],m=d[1],y=Object(a.useState)("2222"),f=Object(s.a)(y,2),k=f[0],g=f[1],R=Object(a.useState)(""),h=Object(s.a)(R,2),P=h[0],v=h[1];function O(){return(O=Object(o.a)(u.a.mark((function e(r,t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i?N.dispatch(H(r,t)):N.dispatch(G(r,t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return n.a.createElement("div",{className:"registration-form__wrapper"},n.a.createElement("div",{className:"registration-form"},n.a.createElement("button",{onClick:function(){return l(!i)}},i?"Have an account? Log in":"Go to registration"),i?"Sign up to enjoy the best music player":"Log in to enjoy the best music player",n.a.createElement("input",{id:"login",type:"text",placeholder:"Enter your login",onChange:function(e){return m(e.target.value)},value:p}),n.a.createElement("input",{id:"password",type:"password",placeholder:"Enter your password",onChange:function(e){return g(e.target.value)},value:k}),i?n.a.createElement("input",{id:"passwordTwo",type:"password",placeholder:"Repeat your password",onChange:function(e){return v(e.target.value)}}):"",n.a.createElement("div",null,i?e.nameHasAlreadyTaken:e.loggedOrNotDescription),n.a.createElement("button",{onClick:function(){return function(e,r){return O.apply(this,arguments)}(p,k)},disabled:i?k!==P||p.length<2||k.length<2:p.length<2||k.length<2},"ok")))})),B=function(e){return{type:"CURRENT_TRACK",index:e}},J=I("/graphql",{Authorization:"Bearer "+localStorage.authToken});var K=function(e,r){return N.dispatch(B(r)),D("\u0441urrentTrack",J('\n            query currentTrack{\n            TrackFindOne(query:"[{\\"_id\\":\\"'.concat(e,'\\"}]"){url originalFileName id3{artist album title genre year}}\n            }    \n    ')))},V=Object(d.b)((function(e){return{currentTrackUrl:e.promiseReducer&&e.promiseReducer.\u0441urrentTrack&&e.promiseReducer.\u0441urrentTrack.payload&&e.promiseReducer.\u0441urrentTrack.payload.data&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.url,currentTrackName:e.promiseReducer&&e.promiseReducer.\u0441urrentTrack&&e.promiseReducer.\u0441urrentTrack.payload&&e.promiseReducer.\u0441urrentTrack.payload.data&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.originalFileName,currentPlaylistArr:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne.tracks,index:e.currentSongReducer&&e.currentSongReducer.index}}),null)((function(e){function r(){N.dispatch(K(e.currentPlaylistArr[(e.index+1)%e.currentPlaylistArr.length]._id,e.index+1))}return n.a.createElement("div",{className:"footer"},n.a.createElement("div",{className:"footer-player"},n.a.createElement("button",{onClick:function(){return function(){var r=(e.currentPlaylistArr.length+(e.index-1)%e.currentPlaylistArr.length)%e.currentPlaylistArr.length;N.dispatch(K(e.currentPlaylistArr[r]._id,r))}()},style:{outline:"none"},disabled:void 0===e.index},"prev"),n.a.createElement("audio",{id:"audio",src:"/"+e.currentTrackUrl,preload:"auto",controls:"controls",autoPlay:!0,onEnded:function(){return r()},style:{outline:"none"}},"//ended   suspend- \u043e\u0448\u0438\u0431\u043a\u0438 \u0438\u043d\u0435\u0442\u0430 volumechange"),n.a.createElement("button",{onClick:function(){return r()},disabled:void 0===e.index,style:{outline:"none"}},"next")))})),W=t(66),z=Object(d.b)((function(e){return{nameLoggedUser:"data"in e.authReducer&&e.authReducer.data.sub.login||"Guest"}}),null)((function(e){var r=Object(d.b)(null,{onClick:S})("button");return n.a.createElement("div",{className:"header-div"},n.a.createElement("p",null,"The best player"),"Guest"==e.nameLoggedUser?n.a.createElement("p",null,e.nameLoggedUser):n.a.createElement("div",null,n.a.createElement(r,null,"Log out"),n.a.createElement("p",null,e.nameLoggedUser)))}));var Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:localStorage.lastPLaylist;return localStorage.lastPLaylist=e,D("\u0441urrentPlayList",J('\n            query allPlaylists{\n            PlaylistFindOne(query:"[{\\"_id\\":\\"'.concat(localStorage.lastPLaylist,'\\"}]"){_id name tracks{_id originalFileName id3{title album artist year genre trackNumber}}}\n            }')))},Q=Object(d.b)((function(e){return{currentPlaylistId:e.promiseReducer&&e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne._id}}))((function(e){var r={};return e.currentPlaylistId===e.id&&(r={color:"chartreuse"}),n.a.createElement("div",{className:"playlist-one",style:r,onClick:function(){return N.dispatch(Y(e.id))}},e.name+" ")}));var X=function(e){return D("allPlaylists",J('\n\n             query playlists{\n                PlaylistFind(query: "[{\\"___owner\\": \\"'.concat(e,'\\"}]")\n                 {name _id description\n                    tracks{\n                        _id\n                    }}\n             } \n        ')))};var Z=function(e,r){return function(){var t=Object(o.a)(u.a.mark((function t(a){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,a(D("newTrackList",J('\n\n        mutation addPlaylist{\n            PlaylistUpsert(playlist:\n            {name:"'.concat(e,'"}){_id}\n        }\n        '))));case 3:N.dispatch(X(r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},ee=function(e){var r=Object(a.useState)(!1),t=Object(s.a)(r,2),i=t[0],l=t[1],c=Object(a.useState)(""),u=Object(s.a)(c,2),o=u[0],d=u[1];return n.a.createElement("div",{className:"playlist-all"},n.a.createElement("button",{onClick:function(){l(!i)}},"add new playlist"),i&&n.a.createElement("div",null,n.a.createElement("input",{type:"text",placeholder:"write name",onChange:function(e){return d(e.target.value)}}),n.a.createElement("button",{onClick:function(){return N.dispatch(Z(o,e.id))}},"create")),n.a.createElement("p",null,"All Playlists:"),e.allPlaylists.map((function(e,r){return n.a.createElement(Q,{name:e.name,id:e._id,"des\u0441ription":e.description,key:r})})))},re=t(65),te=function(){return n.a.createElement(re.a,{className:"pre",color:"white"})},ae=Object(d.b)((function(e){return{status:e.promiseReducer&&e.promiseReducer.allPlaylists&&e.promiseReducer.allPlaylists.status,allPlaylists:e.promiseReducer&&e.promiseReducer.allPlaylists&&e.promiseReducer.allPlaylists.payload&&e.promiseReducer.allPlaylists.payload.data&&e.promiseReducer.allPlaylists.payload.data.PlaylistFind,id:e.authReducer&&e.authReducer.data&&e.authReducer.data.sub.id}}))((function(e){var r=Object(a.useState)(""),t=Object(s.a)(r,2);t[0],t[1];return Object(a.useEffect)((function(){N.dispatch(X(e.id)),N.dispatch(Y())}),[]),n.a.createElement("div",{className:"aside"},"Your playlists:","RESOLVED"===e.status&&e.allPlaylists?n.a.createElement(ee,{allPlaylists:e.allPlaylists,id:e.id}):n.a.createElement(te,null))})),ne=t(32),ie=t(33);var le=function(e,r,t){var a=[].concat(Object(ie.a)(r),[Object(L.a)({},"_id",t)]);return function(){var r=Object(o.a)(u.a.mark((function r(t){return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(D("addTrack",J("\n       \n    mutation addtrack($idPlaylist:ID,$arr:[TrackInput]){   \n         PlaylistUpsert(playlist:{_id: $idPlaylist,\n                tracks:$arr\n            }){_id}\n         }\n         \n         ",{idPlaylist:e,arr:a})));case 2:return r.next=4,N.dispatch(Y(e));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()};var ce=Object(d.b)((function(e){return{playlistId:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne._id,arr:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne.tracks}}),null)((function(e){var r=[];e.arr&&null!=e.arr&&e.arr.map((function(e){return r.push(Object(L.a)({},"_id",e._id))}));var t=Object(a.useCallback)((function(t){t.map((function(t){var a=new FormData;a.append("track",t),N.dispatch(function(e,r,t){return D("upload",fetch("/track",{method:"POST",headers:localStorage.authToken?{Authorization:"Bearer "+localStorage.authToken}:{},body:e}).then((function(e){return e.json()})).then((function(e){return N.dispatch(le(t,r,e._id))})))}(a,r,e.playlistId))}))})),i=Object(ne.a)({onDrop:t}),l=i.getRootProps,c=i.getInputProps;return i.isDragActive,n.a.createElement("div",Object.assign({className:"main__description__dropzone"},l()),n.a.createElement("input",c()),"+")})),ue=Object(d.b)((function(e){return{album:e.promiseReducer.\u0441urrentTrack&&e.promiseReducer.\u0441urrentTrack.payload&&e.promiseReducer.\u0441urrentTrack.payload.data&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3.album,artist:e.promiseReducer.\u0441urrentTrack&&e.promiseReducer.\u0441urrentTrack.payload&&e.promiseReducer.\u0441urrentTrack.payload.data&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3.artist,genre:e.promiseReducer.\u0441urrentTrack&&e.promiseReducer.\u0441urrentTrack.payload&&e.promiseReducer.\u0441urrentTrack.payload.data&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3.genre,title:e.promiseReducer.\u0441urrentTrack&&e.promiseReducer.\u0441urrentTrack.payload&&e.promiseReducer.\u0441urrentTrack.payload.data&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3&&e.promiseReducer.\u0441urrentTrack.payload.data.TrackFindOne.id3.title}}),null)((function(e){return n.a.createElement("div",{className:"main__description"},n.a.createElement("div",{className:"main__description__description-song"},n.a.createElement("div",{className:"main__description__description-song-name"},n.a.createElement("div",null,e.title||"\u041c\u0435\u043b\u0430\u043d\u0438"),n.a.createElement("div",null,e.artist||"\u0410\u0441\u0441\u0430\u0438")),n.a.createElement("div",{className:"main__description__description-song-teg"},n.a.createElement("div",null," album: ",e.album||"\u0410\u0432\u0440\u043e\u0440\u0430 \u043e\u043f\u0430"),n.a.createElement("div",null,"genre: ",e.genre||"Hip-Hop"))),n.a.createElement(ce,null))}));var oe=function(e,r,t){var a=[];return e.map((function(e){return a.push(Object(L.a)({},"_id",e._id))})),a.splice(r,1),function(){var e=Object(o.a)(u.a.mark((function e(r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(D("delTrack",J("\n       \n    mutation deltrack($idPlaylist:ID,$arr:[TrackInput]){   \n         PlaylistUpsert(playlist:{_id: $idPlaylist,\n                tracks:$arr\n            }){_id}\n         }\n         \n         ",{idPlaylist:t,arr:a})));case 2:return e.next=4,N.dispatch(Y(t));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},se=Object(d.b)((function(e){return{currentIndex:e.currentSongReducer.index,currentPlayListLength:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne.tracks.length,currentPlayListId:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne._id,currentPlayListTracksArr:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne.tracks}}),null)((function(e){var r={};e.index===e.currentIndex%e.currentPlayListLength&&(r={color:"chartreuse"}),Object(a.useEffect)((function(){e.index===e.currentIndex%e.currentPlayListLength&&t.current.scrollIntoView()}));var t=Object(a.useRef)();return n.a.createElement("div",{className:"main__track-current",ref:t,style:r},n.a.createElement("div",{onClick:function(){N.dispatch(K(e.track._id,e.index))}},e.track&&e.track.originalFileName),n.a.createElement("div",{onClick:function(){return N.dispatch(oe(e.currentPlayListTracksArr,e.index,e.currentPlayListId))}},"x"))})),de=Object(d.b)((function(e){return{playlistName:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne.name,status:e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.status,tracks:e.promiseReducer&&e.promiseReducer.\u0441urrentPlayList&&e.promiseReducer.\u0441urrentPlayList.payload&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne&&e.promiseReducer.\u0441urrentPlayList.payload.data.PlaylistFindOne.tracks}}),null)((function(e){return n.a.createElement("div",{className:"main__tracklist-current"},n.a.createElement("div",{className:"main__tracklist-current-name"}," ",e.playlistName?"Playlist: "+e.playlistName:"Playlist: ","PENDING"===e.status?n.a.createElement(te,null):""),void 0===e.status?"Choose a Playlist":"","RESOLVED"===e.status&&null!=e.tracks?e.tracks.map((function(e,r){return n.a.createElement(se,{track:e,index:r,key:r})})):"")})),pe=function(){return n.a.createElement("div",{className:"main"},n.a.createElement(z,null),n.a.createElement(ue,null),n.a.createElement(de,null))},me=function(){return n.a.createElement("div",{className:"wrapper"},n.a.createElement("div",{className:"main-wrapper"},n.a.createElement(ae,null),n.a.createElement(pe,null)),n.a.createElement("footer",null,n.a.createElement(V,null)))},ye=function(){return n.a.createElement("div",null,n.a.createElement(d.a,{store:N},n.a.createElement(W.b,{history:k},n.a.createElement(W.c,null,n.a.createElement(W.a,{path:"/registration",component:M}),n.a.createElement(W.a,{exact:!0,path:"/",component:me})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(ye,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[35,1,2]]]);
//# sourceMappingURL=main.9a998992.chunk.js.map